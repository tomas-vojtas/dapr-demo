# dapr-demo

DAPR demo with Invoke, PubSub (rabbitmq) and Workflows (Redis state store)

### run
- stop default DAPR state store (name should be *dapr_redis*) with **docker stop <ID>** - docker compose will create network and we need our state store to be on the same network
- start all containers with **docker-compose up**
- successful start up should end with logs similar to these

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/cbb11ec1-12d5-4283-bfea-325af8f1d4ab)


### invoke
- http://localhost:8080/invoke/test
- InvokeAPI will use DAPR client to invoke PublisherAPI, you should see response from PublisherAPI in browser and you can check the flows in logs.
  
![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/e930e785-a557-4c33-b43c-7ea56ae44819)

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/2f355f1f-b82e-4e2a-b832-c3924a57f12e)


### publish
- http://localhost:8080/invoke/publishtest
- InvokeAPI will use DAPR client to invoke PublisherAPI which will publish message to RabbitMQ via DAPR client, finally SubscriberAPI receive this message and log it.

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/465363c8-723d-4307-b4b7-6981def15dcf)

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/ee4ba252-72d3-417c-a73e-fd0cae908142)


### final
- http://localhost:8080/invoke/publishorder
- Same as publish but now SubscriberAPI uses guid generated by PublisherAPI to start new workflow with said guid as instance id. Workflow will run it's first activity.

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/ebd6d175-e837-4432-8b58-32ea7321d1f9)

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/3dfbb937-b298-452e-94d9-613e68cd75bf)

- We can now use Postman (or curl if you are cool enough) to raise DAPR event by sending following post request. Don't forget to put correct instance id (guid) in the path.

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/c3fce957-e39f-491d-9064-08f52f1126d9)

- After receiving this event workflow will execute next activity.

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/d78b7207-c30a-4a9e-8910-3bbaa7fd3be3)

- We we do the same for second event.

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/c4e839b2-55ca-40e3-adf6-0e06af087db9)

- After which will our workflow be successfully COMPLETED

![image](https://github.com/tomas-vojtas/dapr-demo/assets/144006546/c14011da-b0d6-481f-878a-9da5aaa0f236)
